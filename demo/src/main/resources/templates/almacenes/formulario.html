<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${titulo} + ' - ERP'">Crear Almacén - ERP</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link th:href="@{/css/almacenes.css}" rel="stylesheet">
  <style>
    .form-container {
        max-width: 600px;
        margin: 0 auto;
    }

    .form-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 40px;
    }

    .form-title {
        font-size: 28px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
        text-align: center;
    }

    .form-subtitle {
        font-size: 14px;
        color: var(--text-secondary);
        text-align: center;
        margin-bottom: 32px;
    }

    .form-group {
        margin-bottom: 24px;
    }

    .form-group label {
        display: block;
        font-size: 13px;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 14px 16px;
        background: var(--bg-card-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
        font-size: 14px;
        transition: all 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: var(--accent-cyan);
        box-shadow: 0 0 0 3px rgba(57, 217, 217, 0.1);
    }

    .form-group input::placeholder {
        color: var(--text-secondary);
    }

    .form-group .error-message {
        display: block;
        font-size: 12px;
        color: var(--accent-red);
        margin-top: 6px;
    }

    .form-group input.input-error {
        border-color: var(--accent-red);
    }

    .form-actions {
        display: flex;
        gap: 16px;
        margin-top: 32px;
    }

    .btn-submit {
        flex: 1;
        padding: 14px 24px;
        background: linear-gradient(135deg, var(--accent-cyan), #2dd4bf);
        border: none;
        border-radius: var(--radius-sm);
        color: var(--bg-dark);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-submit:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(57, 217, 217, 0.3);
    }

    .btn-submit:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .btn-cancel {
        flex: 1;
        padding: 14px 24px;
        background: transparent;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        text-align: center;
    }

    .btn-cancel:hover {
        background: var(--bg-card-secondary);
        border-color: var(--accent-red);
        color: var(--accent-red);
    }

    .back-link {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        margin-bottom: 24px;
        transition: color 0.3s;
    }

    .back-link:hover {
        color: var(--accent-cyan);
    }

    .form-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
    }

    .form-icon i {
        font-size: 28px;
        color: white;
    }
  </style>
</head>
<body>
<!-- Sidebar -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
        <path d="M2 17l10 5 10-5"/>
        <path d="M2 12l10 5 10-5"/>
      </svg>
    </div>
    <span class="logo-text">ERP</span>
  </div>
  <nav>
    <ul class="nav-menu">
      <li class="nav-item">
        <a th:href="@{/inicio}" class="nav-link">
          <i class="bi bi-house-door"></i>
          <span>Inicio</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/clientes}" class="nav-link">
          <i class="bi bi-people"></i>
          <span>Clientes</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/trabajadores}" class="nav-link">
          <i class="bi bi-person-badge"></i>
          <span>Trabajadores</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/proveedores}" class="nav-link">
          <i class="bi bi-truck"></i>
          <span>Proveedores</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/almacenes}" class="nav-link active">
          <i class="bi bi-box"></i>
          <span>Almacenes</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/productos}" class="nav-link">
          <i class="bi bi-box-seam"></i>
          <span>Productos</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/pedidos}" class="nav-link">
          <i class="bi bi-cart3"></i>
          <span>Pedidos</span>
        </a>
      </li>
    </ul>
  </nav>
</aside>

<!-- Main Content -->
<main class="main-content">
  <!-- Header -->
  <header class="header">
    <div class="search-box">
      <i class="bi bi-search"></i>
      <input type="text" placeholder="Buscar...">
    </div>
    <div class="header-right">
      <button class="icon-btn">
        <i class="bi bi-envelope"></i>
      </button>
      <button class="icon-btn notification">
        <i class="bi bi-bell"></i>
        <span class="badge-notify">3</span>
      </button>
      <div class="user-profile">
        <div class="user-avatar">AD</div>
        <div class="user-info">
          <span class="user-name">Antonio</span>
          <span class="user-role">Cuenta Admin</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Formulario -->
  <div class="form-container">
    <a th:href="@{/almacenes}" class="back-link">
      <i class="bi bi-arrow-left"></i>
      Volver a Almacenes
    </a>

    <!-- Alertas -->
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="form-card">
      <div class="form-icon">
        <i th:class="${accion == 'crear' ? 'bi bi-box' : 'bi bi-pencil-square'}"></i>
      </div>
      <h1 class="form-title" th:text="${titulo}">Crear Almacén</h1>
      <p class="form-subtitle" th:text="${accion == 'crear' ? 'Ingresa los datos del nuevo almacén' : 'Modifica los datos del almacén'}">
        Ingresa los datos del nuevo almacén
      </p>

      <form th:action="${accion == 'crear'} ? @{/almacenes/crear} : @{/almacenes/actualizar/{id}(id=${almacen.id})}"
            th:object="${almacen}"
            method="post"
            id="formAlmacen">

        <input type="hidden" th:field="*{id}" />

        <div class="form-group">
          <label for="direccion">Dirección</label>
          <input type="text"
                 id="direccion"
                 th:field="*{direccion}"
                 placeholder="Calle Principal 123"
                 required>
          <span id="errorDireccion" class="error-message"></span>
        </div>

        <div class="form-group">
          <label for="capacidad">Capacidad (unidades)</label>
          <input type="number"
                 id="capacidad"
                 th:field="*{capacidad}"
                 placeholder="1000"
                 min="0"
                 required>
          <span id="errorCapacidad" class="error-message"></span>
        </div>

        <div class="form-group">
          <label for="estado">Estado</label>
          <select id="estado" th:field="*{estado}" required>
            <option th:each="est : ${estados}"
                    th:value="${est}"
                    th:text="${est}">
            </option>
          </select>
        </div>

        <div class="form-actions">
          <a th:href="@{/almacenes}" class="btn-cancel">Cancelar</a>
          <button type="submit" class="btn-submit" id="btnSubmit">
            <span th:text="${accion == 'crear' ? 'Crear Almacén' : 'Guardar Cambios'}">Crear Almacén</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const form = document.getElementById('formAlmacen');
  const btnSubmit = document.getElementById('btnSubmit');
  const inputs = form.querySelectorAll('input');

  // Validar en tiempo real
  inputs.forEach(input => {
      input.addEventListener('input', validateForm);
      input.addEventListener('blur', validateField);
  });

  function validateField(e) {
      const field = e.target;
      const fieldId = field.id;
      const value = field.value.trim();

      // Limpiar error del campo
      const errorElement = document.getElementById('error' + capitalize(fieldId));
      if (errorElement) {
          errorElement.textContent = '';
      }
      field.classList.remove('input-error');

      switch(fieldId) {
          case 'direccion':
              if (value === '') {
                  showError(fieldId, 'La dirección es obligatoria');
              } else if (value.length < 3) {
                  showError(fieldId, 'La dirección debe tener al menos 3 caracteres');
              }
              break;
          case 'capacidad':
              if (value === '') {
                  showError(fieldId, 'La capacidad es obligatoria');
              } else if (parseInt(value) < 0) {
                  showError(fieldId, 'La capacidad no puede ser negativa');
              } else if (parseInt(value) === 0) {
                  showError(fieldId, 'La capacidad debe ser mayor a 0');
              }
              break;
      }
  }

  function validateForm() {
      const direccion = document.getElementById('direccion').value.trim();
      const capacidad = document.getElementById('capacidad').value;

      const isDireccionValid = direccion.length >= 3;
      const isCapacidadValid = capacidad !== '' && parseInt(capacidad) > 0;

      const allValid = isDireccionValid && isCapacidadValid;

      btnSubmit.disabled = !allValid;
  }

  function showError(fieldId, message) {
      const errorElement = document.getElementById('error' + capitalize(fieldId));
      if (errorElement) {
          errorElement.textContent = message;
      }
      document.getElementById(fieldId).classList.add('input-error');
  }

  function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
  }

  // Validación inicial
  validateForm();
</script>
</body>
</html>